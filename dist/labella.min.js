!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.labella=n():t.labella=n()}(this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){t.exports={Node:e(1),Force:e(6),Simulator:e(14),Distributor:e(7),Renderer:e(16),util:e(17)}},function(t,n,e){var r=e(2),i=function(t,n,e){if(1===arguments.length&&r.isObject(t)){var i=t;this.idealPos=i.idealPos,this.currentPos=null!==i.currentPos&&void 0!==i.currentPos?i.currentPos:i.idealPos,this.width=i.width,this.data=i.data}else this.idealPos=t,this.currentPos=t,this.width=n,this.data=e;this.previousPos=this.currentPos},o=i.prototype;o.distanceFrom=function(t){var n=this.width/2,e=t.width/2;return Math.max(this.currentPos-n,t.currentPos-e)-Math.min(this.currentPos+n,t.currentPos+e)},o.moveToIdealPosition=function(){return this.currentPos=this.idealPos,this},o.displacement=function(){return this.idealPos-this.currentPos},o.overlapWithNode=function(t,n){return n=null===n||void 0===n?0:n,this.distanceFrom(t)-n<0},o.overlapWithPoint=function(t){var n=this.width/2;return t>=this.currentPos-n&&t<=this.currentPos+n},o.positionBefore=function(t,n){return n=n?n:0,t.currentLeft()-this.width/2-n},o.positionAfter=function(t,n){return n=n?n:0,t.currentRight()+this.width/2+n},o.currentRight=function(){return this.currentPos+this.width/2},o.currentLeft=function(){return this.currentPos-this.width/2},o.idealRight=function(){return this.idealPos+this.width/2},o.idealLeft=function(){return this.idealPos-this.width/2},o.halfWidth=function(){return this.width/2},o.velocity=function(t){return t=t||1,(this.currentPos-this.previousPos)/t},o.kineticEnergy=function(){var t=this.velocity();return t*t},o.createStub=function(t){var n=new i({idealPos:this.idealPos,currentPos:this.currentPos,width:t,data:this.data});return n.child=this,this.parent=n,n},o.isStub=function(){return!!this.child},o.getPathToRoot=function(){for(var t=[],n=this;n;)t.push(n),n=n.parent;return t},o.getPathFromRoot=function(){return this.getPathToRoot().reverse()},o.getRoot=function(){for(var t=this,n=this;n;)t=n,n=n.parent;return t},o.getLevel=function(){for(var t=0,n=this.parent;n;)n=n.parent,t++;return t},o.clone=function(){return new i({idealPos:this.idealPos,currentPos:this.currentPos,width:this.width,data:this.data})},o.isBumping=function(t,n){var e=this.force||0,r=t.force||0;return this.overlapWithNode(t,n)&&(e*r>0||0===e&&0>r||e>0&&0===r||e>0&&0>r)},t.exports=i},function(t,n,e){var r=e(3),i=e(4),o=e(5);t.exports=function(){var t={};return t.sum=function(t,n){return t.map(n).reduce(function(t,n){return t+n},0)},t.isObject=function(t){return"object"==typeof t&&null!==t},t.isDefined=function(t){return null!==t&&void 0!==t},t.extend=r,t.dispatch=i,t.rebind=o,t.extractKeys=function(t,n){return n.reduce(function(n,e){return n[e]=t[e],n},{})},t}()},function(t,n){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===r.call(t)},o=function(t){"use strict";if(!t||"[object Object]"!==r.call(t))return!1;var n=e.call(t,"constructor"),i=t.constructor&&t.constructor.prototype&&e.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!i)return!1;var o;for(o in t);return void 0===o||e.call(t,o)};t.exports=function s(){"use strict";var t,n,e,r,u,a,c=arguments[0],h=1,f=arguments.length,l=!1;for("boolean"==typeof c?(l=c,c=arguments[1]||{},h=2):("object"!=typeof c&&"function"!=typeof c||null==c)&&(c={});f>h;++h)if(t=arguments[h],null!=t)for(n in t)e=c[n],r=t[n],c!==r&&(l&&r&&(o(r)||(u=i(r)))?(u?(u=!1,a=e&&i(e)?e:[]):a=e&&o(e)?e:{},c[n]=s(l,a,r)):void 0!==r&&(c[n]=r));return c}},function(t,n){function e(t,n){try{for(var e in n)Object.defineProperty(t.prototype,e,{value:n[e],enumerable:!1})}catch(r){t.prototype=n}}function r(){}function i(t){return l+t in this}function o(t){return t=l+t,t in this&&delete this[t]}function s(){var t=[];return this.forEach(function(n){t.push(n)}),t}function u(){var t=0;for(var n in this)n.charCodeAt(0)===p&&++t;return t}function a(){for(var t in this)if(t.charCodeAt(0)===p)return!1;return!0}function c(){}function h(t){function n(){for(var n,r=e,i=-1,o=r.length;++i<o;)(n=r[i].on)&&n.apply(this,arguments);return t}var e=[],i=new r;return n.on=function(n,r){var o,s=i.get(n);return arguments.length<2?s&&s.on:(s&&(s.on=null,e=e.slice(0,o=e.indexOf(s)).concat(e.slice(o+1)),i.remove(n)),r&&e.push(i.set(n,{on:r})),t)},n}var f={version:"3.4.4"};f.map=function(t){var n=new r;if(t instanceof r)t.forEach(function(t,e){n.set(t,e)});else for(var e in t)n.set(e,t[e]);return n},e(r,{has:i,get:function(t){return this[l+t]},set:function(t,n){return this[l+t]=n},remove:o,keys:s,values:function(){var t=[];return this.forEach(function(n,e){t.push(e)}),t},entries:function(){var t=[];return this.forEach(function(n,e){t.push({key:n,value:e})}),t},size:u,empty:a,forEach:function(t){for(var n in this)n.charCodeAt(0)===p&&t.call(this,n.substring(1),this[n])}});var l="\x00",p=l.charCodeAt(0);f.dispatch=function(){for(var t=new c,n=-1,e=arguments.length;++n<e;)t[arguments[n]]=h(t);return t},c.prototype.on=function(t,n){var e=t.indexOf("."),r="";if(e>=0&&(r=t.substring(e+1),t=t.substring(0,e)),t)return arguments.length<2?this[t].on(r):this[t].on(r,n);if(2===arguments.length){if(null==n)for(t in this)this.hasOwnProperty(t)&&this[t].on(r,null);return this}},t.exports=f.dispatch},function(t,n){function e(t,n,e){return function(){var r=e.apply(n,arguments);return r===n?t:r}}var r=function(t,n){for(var r,i=1,o=arguments.length;++i<o;)t[r=arguments[i]]=e(t,n,n[r]);return t};t.exports=r},function(t,n,e){var r=e(7),i=e(10),o=e(2),s=e(11),u=e(12),a={damping:.1,epsilon:.003,timestep:1,nodeSpacing:3,minPos:0,maxPos:null,pullForce:new s(1),roundsPerTick:100,algorithm:"overlap",density:.85,stubWidth:1},c=function(t){var n={},e=o.dispatch("start","tick","endLayer","end"),s=o.extend({},a),c=new r,h=[],f=null,l=!1;return n.nodes=function(t){return arguments.length?(h=t,f=null,n):h},n.getLayers=function(){return f},n.options=function(t){if(!arguments.length)return s;s=o.extend(s,t);var e=o.extractKeys(s,Object.keys(r.DEFAULT_OPTIONS));return o.isDefined(s.minPos)&&o.isDefined(s.maxPos)?e.layerWidth=s.maxPos-s.minPos:e.layerWidth=null,c.options(e),n},n.options(t),n.distribute=function(){if(l)throw"This function cannot be called while the simulator is running. Stop it first.";f=c.distribute(h);var t=o.extractKeys(s,Object.keys(Simulator.DEFAULT_OPTIONS));return simulators=f.map(function(n){return new Simulator(t).nodes(n)}),n},n.initialize=function(){if(l)throw"This function cannot be called while the simulator is running. Stop it first.";return simulators.forEach(function(t){t.initialize()}),n},n.step=function(){return simulators.forEach(function(t){t.step()}),n},n.stop=function(){return simulators.forEach(function(t){t.stop()}),n},n.start=function(t){var r={nodeSpacing:s.nodeSpacing,minPos:s.minPos,maxPos:s.maxPos};return setTimeout(function(){e.start({type:"start"}),f=c.distribute(h),f.map(function(t,n){u(t,r),e.endLayer({type:"endLayer",layerIndex:n})}),e.end({type:"end"})}),n},n.resume=function(t){if(0===f.length)return n;if(!l){var r=0;e.start({type:"start"});var i=function(){var n=simulators[r];n&&(n.on("tick",function(t){e.tick(o.extend({},t,{layerIndex:r}))}),n.on("end",function(t){e.endLayer(o.extend({},t,{type:"endLayer",layerIndex:r})),r++,r<f.length?i():(e.end({type:"end"}),l=!1)}),r>0?n.start(t):n.resume(t))};i()}return n},n.energy=function(){return o.sum(simulators,function(t){return t.energy()})},n.isStable=function(){return simulators.every(function(t){return t.isStable()})},n.reset=n.initialize,n.metrics=function(){return Object.keys(i).map(function(t){return{name:t,value:n.metric(t)}})},n.metric=function(t){switch(t){case"overflow":return i[t](f,s.minPos,s.maxPos);case"overDensity":return i[t](f,s.density,s.layerWidth,s.nodeSpacing-1);case"overlapCount":return i[t](f,s.nodeSpacing-1);default:return i[t]?i[t](f):null}},o.rebind(n,e,"on"),n};c.DEFAULT_OPTIONS=a,t.exports=c},function(t,n,e){var r=e(2),i=e(8),o={algorithm:"overlap",layerWidth:1e3,density:.75,nodeSpacing:3,stubWidth:1},s=function(t){var n={};t=r.extend({},o,t),n.options=function(e){return arguments.length?(t=r.extend(t,e),n):t},n.computeRequiredWidth=function(n){return r.sum(n,function(n){return n.width+t.nodeSpacing})-t.nodeSpacing},n.maxWidthPerLayer=function(){return t.density*t.layerWidth},n.needToSplit=function(t){return n.estimateRequiredLayers(t)>1},n.estimateRequiredLayers=function(e){return t.layerWidth?Math.ceil(n.computeRequiredWidth(e)/n.maxWidthPerLayer()):1};var e={simple:function(e){for(var r=n.estimateRequiredLayers(e),i=[],o=0;r>o;o++)i.push([]);return e.forEach(function(n,e){var o=e%r;i[o].push(n);for(var s=n,u=o-1;u>=0;u--)s=s.createStub(t.stubWidth),i[u].push(s)}),i},roundRobin:function(t){var n=[];return n},overlap:function(e){for(var r=[],i=n.maxWidthPerLayer(),o=e.concat(),s=n.computeRequiredWidth(o);s>i;){n.countIdealOverlaps(o);var u=o.concat(),a=s;for(o=[];u.length>2&&a>i;){u.sort(function(t,n){return n.overlapCount-t.overlapCount});var c=u.shift();a-=c.width,a+=t.stubWidth,c.overlaps.forEach(function(t){t.overlapCount--}),o.push(c)}r.push(u),s=n.computeRequiredWidth(o)}o.length>0&&r.push(o);for(var h=r.length-1;h>=1;h--)for(var f=r[h],l=0;l<f.length;l++){var p=f[l];if(!p.isStub())for(var d=p,v=h-1;v>=0;v--)d=d.createStub(t.stubWidth),r[v].push(d)}return r}};return n.countIdealOverlaps=function(n){var e=new i(t.layerWidth/2);return n.forEach(function(t){e.add([t.idealLeft(),t.idealRight(),t])}),n.forEach(function(t){var n=e.search(t.idealLeft(),t.idealRight());t.overlaps=n,t.overlapCount=n.length}),n},n.distribute=function(r){if(!r||0===r.length)return[];if(r=r.concat().sort(function(t,n){return t.idealPos-n.idealPos}),!n.needToSplit(r))return[r];if("function"==typeof t.algorithm)return t.algorithm(r,t);if("none"==t.algorithm)return r;if(e.hasOwnProperty(t.algorithm))return e[t.algorithm](r);throw"Unknown algorithm: "+t.algorithm},n};s.DEFAULT_OPTIONS=o,t.exports=s},function(t,n,e){function r(t,n){if(n||(n={}),this.startKey=n.startKey||0,this.endKey=n.endKey||1,this.intervalHash={},this.pointTree=new c({compare:function(t,n){if(null==t)return-1;if(null==n)return 1;var e=t[0]-n[0];return e>0?1:0==e?0:-1}}),this._autoIncrement=0,!t||"number"!=typeof t)throw new Error("you must specify center index as the 2nd argument.");this.root=new u(t,this)}function i(t,n){return n.end<t.idx?(t.left||(t.left=new u(n.start+n.end>>1,this)),i.call(this,t.left,n)):t.idx<n.start?(t.right||(t.right=new u(n.start+n.end>>1,this)),i.call(this,t.right,n)):t.insert(n)}function o(t,n,e){return t?n<t.idx?(t.starts.every(function(t){var r=t.start<=n;return r&&e.push(t.result()),r}),o.call(this,t.left,n,e)):n>t.idx?(t.ends.every(function(t){var r=t.end>=n;return r&&e.push(t.result()),r}),o.call(this,t.right,n,e)):void t.starts.map(function(t){e.push(t.result())}):void 0}function s(t,n,e){if(0>=n-t)throw new Error("end must be greater than start. start: "+t+", end: "+n);var r={},i=[];o.call(this,this.root,t+n>>1,i,!0),i.forEach(function(t){r[t.id]=!0});for(var s=this.pointTree.bsearch([t,null]),u=this.pointTree;s>=0&&u[s][0]==t;)s--;var a=this.pointTree.bsearch([n,null]);if(a>=0){for(var c=u.length-1;c>=a&&u[a][0]<=n;)a++;u.slice(s+1,a).forEach(function(t){var n=t[1];r[n]=!0},this),Object.keys(r).forEach(function(r){var i=this.intervalHash[r];e.push(i.result(t,n))},this)}}function u(t){this.idx=t,this.starts=new c({compare:function(t,n){if(null==t)return-1;if(null==n)return 1;var e=t.start-n.start;return e>0?1:0==e?0:-1}}),this.ends=new c({compare:function(t,n){if(null==t)return-1;if(null==n)return 1;var e=t.end-n.end;return 0>e?1:0==e?0:-1}})}function a(t,n,e,r){if(this.id=n,this.start=t[e],this.end=t[r],this.data=t,"number"!=typeof this.start||"number"!=typeof this.end)throw new Error("start, end must be number. start: "+this.start+", end: "+this.end);if(this.start>=this.end)throw new Error("start must be smaller than end. start: "+this.start+", end: "+this.end)}var c=e(9);r.prototype.add=function(t,n){if(this.intervalHash[n])throw new Error("id "+n+" is already registered.");if(void 0==n){for(;this.intervalHash[this._autoIncrement];)this._autoIncrement++;n=this._autoIncrement}var e=new a(t,n,this.startKey,this.endKey);this.pointTree.insert([e.start,n]),this.pointTree.insert([e.end,n]),this.intervalHash[n]=e,this._autoIncrement++,i.call(this,this.root,e)},r.prototype.search=function(t,n){var e=[];if("number"!=typeof t)throw new Error(t+": invalid input");if(void 0==n)o.call(this,this.root,t,e);else{if("number"!=typeof n)throw new Error(t+","+n+": invalid input");s.call(this,t,n,e)}return e},r.prototype.remove=function(t){},u.prototype.insert=function(t){this.starts.insert(t),this.ends.insert(t)},a.prototype.result=function(t,n){var e={id:this.id,data:this.data};if("number"==typeof t&&"number"==typeof n){var r=Math.max(this.start,t),i=Math.min(this.end,n),o=i-r;e.rate1=o/(n-t),e.rate2=o/(this.end-this.start)}return e},t.exports=r},function(t,n,e){var r,i,o;!function(e,s){i=[],r=s,o="function"==typeof r?r.apply(n,i):r,!(void 0!==o&&(t.exports=o))}(this,function(){var t=function n(){var t=null,e={},r=arguments;["0","1"].forEach(function(n){var i=r[n];Array.isArray(i)?t=i:i&&"object"==typeof i&&(e=i)}),"function"==typeof e.filter&&(this._filter=e.filter),"function"==typeof e.compare?this._compare=e.compare:"string"==typeof e.compare&&n.compares[e.compare]&&(this._compare=n.compares[e.compare]),this._unique=!!e.unique,e.resume&&t?t.forEach(function(t,n){this.push(t)},this):t&&this.insert.apply(this,t)};return t.create=function(n,e){return new t(n,e)},t.prototype=new Array,t.prototype.constructor=Array.prototype.constructor,t.prototype.insertOne=function(t){var n=this.bsearch(t);return this._unique&&null!=this.key(t,n)?!1:this._filter(t,n)?(this.splice(n+1,0,t),n+1):!1},t.prototype.insert=function(){return Array.prototype.map.call(arguments,function(t){return this.insertOne(t)},this)},t.prototype.remove=function(t){return this.splice(t,1),this},t.prototype.bsearch=function(t){if(!this.length)return-1;for(var n,e=0,r=this.length;r-e>1;){n=Math.floor((e+r)/2),mval=this[n];var i=this._compare(t,mval);if(0==i)return n;i>0?e=n:r=n}return 0==e&&this._compare(this[0],t)>0?-1:e},t.prototype.key=function(t,n){null==n&&(n=this.bsearch(t));var e=n;if(-1==e||this._compare(this[e],t)<0)return e+1<this.length&&0==this._compare(this[e+1],t)?e+1:null;for(;e>=1&&0==this._compare(this[e-1],t);)e--;return e},t.prototype.keys=function(t,n){var e=[];null==n&&(n=this.bsearch(t));for(var r=n;r>=0&&0==this._compare(this[r],t);)e.push(r),r--;var i=this.length;for(r=n+1;i>r&&0==this._compare(this[r],t);)e.push(r),r++;return e.length?e:null},t.prototype.unique=function(t){if(t)return this.filter(function(t,n){return 0==n||0!=this._compare(this[n-1],t)},this);var n=0;return this.map(function(t,e){return 0==e||0!=this._compare(this[e-1],t)?null:e-n++},this).forEach(function(t){null!=t&&this.remove(t)},this),this},t.prototype.toArray=function(){return this.slice()},t.prototype._filter=function(t,n){return!0},t.compares={number:function(t,n){var e=t-n;return e>0?1:0==e?0:-1},string:function(t,n){return t>n?1:t==n?0:-1}},t.prototype._compare=t.compares.string,t})},function(t,n,e){var r=e(2),t=function(){function t(t){return 0===t.length||Array.isArray(t[0])?t:[t]}var n={};return n.displacement=function(n){if(0===n.length)return 0;var e=t(n);return r.sum(e,function(t){return r.sum(t,function(t){return Math.abs(t.displacement())})})},n.overflow=function(n,e,i){if(0===n.length||!r.isDefined(e)&&!r.isDefined(i))return 0;var o=t(n);return r.sum(o,function(t){return r.sum(t,function(t){var n=t.currentLeft(),o=t.currentRight();if(r.isDefined(e)){if(e>=o)return t.width;if(e>n)return e-n}if(r.isDefined(i)){if(n>=i)return t.width;if(o>i)return o-i}return 0})})},n.overDensity=function(n,e,i,o){if(0===n.length)return 0;var s=e*i,u=t(n);return r.sum(u,function(t){var n=r.sum(t,function(t){return t.width+o})-o;return s>=n?0:n-s})},n.overlapCount=function(n,e){if(0===n.length)return 0;var i=t(n);return r.sum(i,function(t){for(var n=0,r=0;r<t.length;r++)for(var i=r+1;i<t.length;i++)t[r].overlapWithNode(t[i],e)&&n++;return n})},n.overlapSpace=function(n){if(0===n.length)return 0;var e=t(n);return r.sum(e,function(t){for(var n=0,e=0;e<t.length;e++)for(var r=e+1;r<t.length;r++){var i=t[e].distanceFrom(t[r]);n+=0>i?Math.abs(i):0}return n})},n.weightedAllocatedSpace=function(n){if(0===n.length)return 0;var e=t(n);return r.sum(e,function(t,n){return n*r.sum(t,function(t){return t.width})})},n}();t.exports=t},function(t,n,e){var r,i;r=[],i=function(){function t(t){this.springK=t}return t.prototype.computeForce=function(t){return this.springK*t},t}.apply(n,r),!(void 0!==i&&(t.exports=i))},function(t,n,e){function r(t){return t[t.length-1]}var i=e(13),o=e(2),s={nodeSpacing:3,minPos:0,maxPos:null};t.exports=function(t,n){if(t.length>0){n=o.extend(s,n),t.filter(function(t){return!!t.parent}).forEach(function(t){t.idealPos=t.parent.currentPos}),t.sort(function(t,n){return t.idealPos-n.idealPos});for(var e=t.map(function(t){var n=new i.Variable(t.idealPos);return n.node=t,n}),u=[],a=1;a<e.length;a++){var c=e[a-1],h=e[a];u.push(new i.Constraint(c,h,(c.node.width+h.node.width)/2+n.nodeSpacing))}if(o.isDefined(n.minPos)){var f=new i.Variable(n.minPos,1e10),l=e[0];u.push(new i.Constraint(f,l,l.node.width/2)),e.unshift(f)}if(o.isDefined(n.maxPos)){var p=new i.Variable(n.maxPos,1e10),d=r(e);u.push(new i.Constraint(d,p,d.node.width/2)),e.push(p)}var v=new i.Solver(e,u);v.solve(),e.filter(function(t){return t.node}).map(function(t){return t.node.currentPos=Math.round(t.position()),t})}return t}},function(t,n){var e={},r=function(){function t(t){this.scale=t,this.AB=0,this.AD=0,this.A2=0}return t.prototype.addVariable=function(t){var n=this.scale/t.scale,e=t.offset/t.scale,r=t.weight;this.AB+=r*n*e,this.AD+=r*n*t.desiredPosition,this.A2+=r*n*n},t.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},t}();e.PositionStats=r;var i=function(){function t(t,n,e,r){void 0===r&&(r=!1),this.left=t,this.right=n,this.gap=e,this.equality=r,this.active=!1,this.unsatisfiable=!1,this.left=t,this.right=n,this.gap=e,this.equality=r}return t.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},t}();e.Constraint=i;var o=function(){function t(t,n,e){void 0===n&&(n=1),void 0===e&&(e=1),this.desiredPosition=t,this.weight=n,this.scale=e,this.offset=0}return t.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},t.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},t.prototype.visitNeighbours=function(t,n){var e=function(e,r){return e.active&&t!==r&&n(e,r)};this.cOut.forEach(function(t){return e(t,t.right)}),this.cIn.forEach(function(t){return e(t,t.left)})},t}();e.Variable=o;var s=function(){function t(t){this.vars=[],t.offset=0,this.ps=new r(t.scale),this.addVariable(t)}return t.prototype.addVariable=function(t){t.block=this,this.vars.push(t),this.ps.addVariable(t),this.posn=this.ps.getPosn()},t.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var t=0,n=this.vars.length;n>t;++t)this.ps.addVariable(this.vars[t]);this.posn=this.ps.getPosn()},t.prototype.compute_lm=function(t,n,e){var r=this,i=t.dfdv();return t.visitNeighbours(n,function(n,o){var s=r.compute_lm(o,t,e);o===n.right?(i+=s*n.left.scale,n.lm=s):(i+=s*n.right.scale,n.lm=-s),e(n)}),i/t.scale},t.prototype.populateSplitBlock=function(t,n){var e=this;t.visitNeighbours(n,function(n,r){r.offset=t.offset+(r===n.right?n.gap:-n.gap),e.addVariable(r),e.populateSplitBlock(r,t)})},t.prototype.traverse=function(t,n,e,r){var i=this;void 0===e&&(e=this.vars[0]),void 0===r&&(r=null),e.visitNeighbours(r,function(r,o){n.push(t(r)),i.traverse(t,n,o,e)})},t.prototype.findMinLM=function(){var t=null;return this.compute_lm(this.vars[0],null,function(n){!n.equality&&(null===t||n.lm<t.lm)&&(t=n)}),t},t.prototype.findMinLMBetween=function(t,n){this.compute_lm(t,null,function(){});var e=null;return this.findPath(t,null,n,function(t,n){!t.equality&&t.right===n&&(null===e||t.lm<e.lm)&&(e=t)}),e},t.prototype.findPath=function(t,n,e,r){var i=this,o=!1;return t.visitNeighbours(n,function(n,s){o||s!==e&&!i.findPath(s,t,e,r)||(o=!0,r(n,s))}),o},t.prototype.isActiveDirectedPathBetween=function(t,n){if(t===n)return!0;for(var e=t.cOut.length;e--;){var r=t.cOut[e];if(r.active&&this.isActiveDirectedPathBetween(r.right,n))return!0}return!1},t.split=function(n){return n.active=!1,[t.createSplitBlock(n.left),t.createSplitBlock(n.right)]},t.createSplitBlock=function(n){var e=new t(n);return e.populateSplitBlock(n,null),e},t.prototype.splitBetween=function(n,e){var r=this.findMinLMBetween(n,e);if(null!==r){var i=t.split(r);return{constraint:r,lb:i[0],rb:i[1]}}return null},t.prototype.mergeAcross=function(t,n,e){n.active=!0;for(var r=0,i=t.vars.length;i>r;++r){var o=t.vars[r];o.offset+=e,this.addVariable(o)}this.posn=this.ps.getPosn()},t.prototype.cost=function(){for(var t=0,n=this.vars.length;n--;){var e=this.vars[n],r=e.position()-e.desiredPosition;t+=r*r*e.weight}return t},t}();e.Block=s;var u=function(){function t(t){this.vs=t;var n=t.length;for(this.list=new Array(n);n--;){var e=new s(t[n]);this.list[n]=e,e.blockInd=n}}return t.prototype.cost=function(){for(var t=0,n=this.list.length;n--;)t+=this.list[n].cost();return t},t.prototype.insert=function(t){t.blockInd=this.list.length,this.list.push(t)},t.prototype.remove=function(t){var n=this.list.length-1,e=this.list[n];this.list.length=n,t!==e&&(this.list[t.blockInd]=e,e.blockInd=t.blockInd)},t.prototype.merge=function(t){var n=t.left.block,e=t.right.block,r=t.right.offset-t.left.offset-t.gap;n.vars.length<e.vars.length?(e.mergeAcross(n,t,r),this.remove(n)):(n.mergeAcross(e,t,-r),this.remove(e))},t.prototype.forEach=function(t){this.list.forEach(t)},t.prototype.updateBlockPositions=function(){this.list.forEach(function(t){return t.updateWeightedPosition()})},t.prototype.split=function(t){var n=this;this.updateBlockPositions(),this.list.forEach(function(e){var r=e.findMinLM();null!==r&&r.lm<a.LAGRANGIAN_TOLERANCE&&(e=r.left.block,s.split(r).forEach(function(t){return n.insert(t)}),n.remove(e),t.push(r))})},t}();e.Blocks=u;var a=function(){function t(t,n){this.vs=t,this.cs=n,this.vs=t,t.forEach(function(t){t.cIn=[],t.cOut=[]}),this.cs=n,n.forEach(function(t){t.left.cOut.push(t),t.right.cIn.push(t)}),this.inactive=n.map(function(t){return t.active=!1,t}),this.bs=null}return t.prototype.cost=function(){return this.bs.cost()},t.prototype.setStartingPositions=function(t){this.inactive=this.cs.map(function(t){return t.active=!1,t}),this.bs=new u(this.vs),this.bs.forEach(function(n,e){return n.posn=t[e]})},t.prototype.setDesiredPositions=function(t){this.vs.forEach(function(n,e){return n.desiredPosition=t[e]})},t.prototype.mostViolated=function(){for(var n=Number.MAX_VALUE,e=null,r=this.inactive,i=r.length,o=i,s=0;i>s;++s){var u=r[s];if(!u.unsatisfiable){var a=u.slack();if((u.equality||n>a)&&(n=a,e=u,o=s,u.equality))break}}return o!==i&&(n<t.ZERO_UPPERBOUND&&!e.active||e.equality)&&(r[o]=r[i-1],r.length=i-1),e},t.prototype.satisfy=function(){null==this.bs&&(this.bs=new u(this.vs)),this.bs.split(this.inactive);for(var n=null;(n=this.mostViolated())&&(n.equality||n.slack()<t.ZERO_UPPERBOUND&&!n.active);){var e=n.left.block,r=n.right.block;if(e!==r)this.bs.merge(n);else{if(e.isActiveDirectedPathBetween(n.right,n.left)){n.unsatisfiable=!0;continue}var i=e.splitBetween(n.left,n.right);if(null===i){n.unsatisfiable=!0;continue}this.bs.insert(i.lb),this.bs.insert(i.rb),this.bs.remove(e),this.inactive.push(i.constraint),n.slack()>=0?this.inactive.push(n):this.bs.merge(n)}}},t.prototype.solve=function(){this.satisfy();for(var t=Number.MAX_VALUE,n=this.bs.cost();Math.abs(t-n)>1e-4;)this.satisfy(),t=n,n=this.bs.cost();return n},t.LAGRANGIAN_TOLERANCE=-1e-4,t.ZERO_UPPERBOUND=-1e-10,t}();e.Solver=a,t.exports=e},function(t,n,e){var r=e(15),i=e(11),o=e(2),s={damping:.1,epsilon:.003,timestep:1,nodeSpacing:3,minPos:0,maxPos:null,pullForce:new i(1),roundsPerTick:100},u=function(t){function n(n,e){return n.isBumping(e,t.nodeSpacing)}var e={},i=[],u=o.dispatch("start","tick","end"),a=!1,c=0;return t=o.extend({},s,t),e.nodes=function(t){return arguments.length?(i=t,e):i},e.options=function(n){return arguments.length?(t=o.extend(t,n),e):t},e.pushRightToIdealPositions=function(){for(var n=i.length-1;n>=0;n--){var r=i[n];if(r.currentPos<r.idealPos){var o=n===i.length-1?null:i[n+1];if(!o||r.idealRight()<o.currentLeft())r.moveToIdealPosition();else{var s=r.positionBefore(o,t.nodeSpacing);Math.abs(r.idealPos-s)<Math.abs(r.displacement())&&(r.currentPos=s)}}}return e},e.pushLeftToIdealPositions=function(){for(var n=0;n<i.length;n++){var r=i[n];if(r.currentPos>r.idealPos){var o=0===n?null:i[n-1];if(!o||r.idealLeft()>o.currentRight())r.moveToIdealPosition();else{var s=r.positionAfter(o,t.nodeSpacing);Math.abs(r.idealPos-s)<Math.abs(r.displacement())&&(r.currentPos=s)}}}return e},e.pushToIdealPositions=function(t){return t?e.pushRightToIdealPositions().pushLeftToIdealPositions():e.pushLeftToIdealPositions().pushRightToIdealPositions()},e.initialize=function(){if(a)throw"This function cannot be called while the simulator is running. Stop it first.";return i.filter(function(t){return!!t.parent}).forEach(function(t){t.idealPos=t.parent.currentPos}),i.sort(function(t,n){return t.idealPos-n.idealPos}).forEach(function(n,e){n.currentPos=0===e?n.halfWidth():n.positionAfter(i[e-1],t.nodeSpacing),n.previousPos=n.currentPos}),e},e.step=function(){i.forEach(function(n){n.force=t.pullForce.computeForce(n.displacement())});var s=r.groupAdjacentNodes(i,n);for(s.forEach(function(n){if(n.force=n.totalForce(),n.force<0&&o.isDefined(t.minPos)){var e=n.nodes[0].currentLeft()-t.minPos;0===e?n.force=0:0>e&&(n.force=t.pullForce.computeForce(-e))}});s.length>1;){var u=r.mergeAdjacentGroups(s,n);if(u.length===s.length)break;s=u}s.forEach(function(t){t.assignForceToChildren()});for(var a=i.length-1;a>=0;a--){var c=i[a],h=c.currentPos+c.force*t.damping*t.timestep*t.timestep;if(o.isDefined(t.minPos)&&(h=Math.max(t.minPos+c.halfWidth(),h)),o.isDefined(t.maxPos)&&(h=Math.min(t.maxPos-c.halfWidth(),h)),a>0){var f=i[a-1];h=Math.max(c.positionAfter(f,t.nodeSpacing-1),h)}if(a<i.length-1){var l=i[a+1];h=Math.min(c.positionBefore(l,t.nodeSpacing-1),h)}c.previousPos=c.currentPos,c.currentPos=h}return e},e.start=function(t){if(a)throw"This function cannot be called while the simulator is running. Stop it first.";return e.initialize().resume(t)},e.increaseMaxRound=function(t){t?c+=t:c=0},e.resume=function(n){if(e.increaseMaxRound(n),!a){a=!0,u.start({type:"start"});var r=0,i=function(){return a?r>0&&e.isStable()?"simulation stable, energy: "+e.energy():c&&r>=c?"maximum number of rounds reached: "+c:(e.step(),r++,!1):"stopped"},o=function(){for(var n=0;n<t.roundsPerTick;n++){var e=i();if(e)return u.end({type:"end",round:r,maxRound:c,reason:e}),a=!1,void(c=0)}u.tick({type:"tick",round:r,maxRound:c}),setTimeout(o,0)};o()}return e},e.stop=function(){return a=!1,e},e.energy=function(){return o.sum(i,function(t){return t.kineticEnergy()})},e.isStable=function(){return e.energy()<t.epsilon},e.reset=e.initialize,o.rebind(e,u,"on"),e};u.DEFAULT_OPTIONS=s,t.exports=u},function(t,n){var e=function(t){this.nodes=t||[],this.force=0},r=e.prototype;r.push=function(t){return this.nodes.push(t),this},r.merge=function(t){var n=new e(this.nodes.concat(t.nodes));return n.force=this.force+t.force,n},r.overlapWithGroup=function(t,n){return this.nodes.length>0&&t.nodes.length>0&&this.nodes[this.nodes.length-1].overlapWithNode(t.nodes[0],n)},r.totalForce=function(){return this.nodes.map(function(t){return t.force}).reduce(function(t,n){return t+n},0)},r.assignForceToChildren=function(){var t=this;this.nodes.forEach(function(n){n.force=t.force})},r.isBumping=function(t,n){var e=this.force||0,r=t.force||0;return this.overlapWithGroup(t,n)&&(e*r>0||0===e&&0>r||e>0&&0===r||e>0&&0>r)},e.groupAdjacentNodes=function(t,n){if(t&&t.length>0){for(var r=new e([t[0]]),i=[r],o=1;o<t.length;o++){var s=t[o],u=t[o-1];n(u,s)?r.push(s):(r=new e([s]),i.push(r))}return i}return[]},e.mergeAdjacentGroups=function(t,n){if(t&&t.length>0){for(var e=[],r=t[0],i=1;i<t.length;i++){var o=t[i],s=t[i-1];n(s,o)?r=r.merge(o):(e.push(r),r=o)}return e.push(r),e}return t},t.exports=e},function(t,n,e){function r(t){this.options=c.extend({layerGap:60,nodeHeight:10,direction:"down"},t)}function i(t){return"L "+t.join(" ")}function o(t){return"M "+t.join(" ")}function s(t,n,e){return"C "+t.join(" ")+" "+n.join(" ")+" "+e.join(" ")}function u(t,n){var e=(t[1]+n[1])/2;return s([t[0],e],[n[0],e],n)}function a(t,n){var e=(t[0]+n[0])/2;return s([e,t[1]],[e,n[1]],n)}var c=e(2);r.prototype.getWaypoints=function(t){var n=this.options,e=n.direction,r=t.getPathFromRoot(),i=n.nodeHeight+n.layerGap;return"left"===e?[[[0,r[0].idealPos]]].concat(r.map(function(t,e){var r=i*(e+1)*-1;return[[r+n.nodeHeight,t.currentPos],[r,t.currentPos]]})):"right"===e?[[[0,r[0].idealPos]]].concat(r.map(function(t,e){var r=i*(e+1);return[[r-n.nodeHeight,t.currentPos],[r,t.currentPos]]})):"up"===e?[[[r[0].idealPos,0]]].concat(r.map(function(t,e){var r=i*(e+1)*-1;return[[t.currentPos,r+n.nodeHeight],[t.currentPos,r]]})):[[[r[0].idealPos,0]]].concat(r.map(function(t,e){var r=i*(e+1);return[[t.currentPos,r-n.nodeHeight],[t.currentPos,r]]}))},r.prototype.layout=function(t){var n=this.options,e=n.layerGap+n.nodeHeight;switch(n.direction){case"left":t.forEach(function(t){var r=t.getLevel()*e+n.layerGap;t.x=-r-n.nodeHeight,t.y=t.currentPos,t.dx=n.nodeHeight,t.dy=t.width});break;case"right":t.forEach(function(t){var r=t.getLevel()*e+n.layerGap;t.x=r,t.y=t.currentPos,t.dx=n.nodeHeight,t.dy=t.width});break;case"up":t.forEach(function(t){var r=t.getLevel()*e+n.layerGap;t.x=t.currentPos,t.y=-r-n.nodeHeight,t.dx=t.width,t.dy=n.nodeHeight});break;default:case"down":t.forEach(function(t){var r=t.getLevel()*e+n.layerGap;t.x=t.currentPos,t.y=r,t.dx=t.width,t.dy=n.nodeHeight})}return t},r.prototype.generatePath=function(t){var n=this.options,e=n.direction,r=this.getWaypoints(t,e),s=[o(r[0][0])];return"left"===e||"right"===e?r.reduce(function(t,n,e){return s.push(a(t[t.length-1],n[0])),e<r.length-1&&s.push(i(n[1])),n}):r.reduce(function(t,n,e){return s.push(u(t[t.length-1],n[0])),e<r.length-1&&s.push(i(n[1])),n}),s.join(" ")},t.exports=r},function(t,n,e){var r=e(1),i=e(2);t.exports=function(){var t={},n={minWidth:20,maxWidth:20,minPos:0,maxPos:800};return t.generateNodes=function(t,e){var o=[];e=i.extend({},n,e);for(var s=e.maxPos-e.minPos,u=e.maxWidth-e.minWidth,a=0;t>a;a++)o.push(new r(Math.floor(Math.random()*s)+e.minPos,Math.floor(Math.random()*u)+e.minWidth));return o},t.convertNodesToGraph=function(t){yGap=60;var n={nodes:[],links:[],constraints:[]},e={type:"alignment",axis:"y",offsets:[]};return n.constraints.push(e),n.nodes.push({index:0,x:1,y:yGap,width:1,height:1,fixed:!0}),n.nodes.push({index:0,x:925,y:yGap,width:1,height:1,fixed:!0}),t.forEach(function(t){var r={index:n.nodes.length,x:t.idealPos,y:0,width:1,height:1,fixed:!0};n.nodes.push(r);var i={index:n.nodes.length,x:t.currentPos,y:yGap,width:t.width,height:12,originalNode:t};e.offsets.push({node:i.index,offset:0}),n.nodes.push(i),n.links.push({source:r.index,target:i.index}),n.constraints.push({axis:"y",left:r.index,right:i.index,gap:yGap,equality:!0}),n.constraints.push({axis:"x",left:0,right:i.index,gap:0}),n.constraints.push({axis:"x",left:i.index,right:1,gap:0})}),n},t.updateNodesInGraph=function(t){
return graph.nodes.filter(function(t){return t.originalNode}).map(function(t){return t.originalNode.currentPos=t.x,t.originalNode})},t}()}])});